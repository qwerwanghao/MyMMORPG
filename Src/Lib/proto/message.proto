syntax = "proto3";

package SkillBridge.Message;

option csharp_namespace = "SkillBridge.Message";
option cc_enable_arenas = true;

////////////////////////////////////////////////////////////////
//
//  Basic Defines基本定义
//
////////////////////////////////////////////////////////////////
enum RESULT {
  SUCCESS = 0;
  FAILED  = 1;
}

enum CHARACTER_TYPE {
  Player  = 0;
  NPC     = 1;
  Monster = 2;
}

enum CHARACTER_CLASS {
  NONE    = 0;
  WARRIOR = 1;
  WIZARD  = 2;
  ARCHER  = 3;
}

enum CHARACTER_STATE {
  IDLE = 0;
  MOVE = 1;
}

enum ENTITY_EVENT {
  NONE      = 0;
  IDLE      = 1;
  MOVE_FWD  = 2;
  MOVE_BACK = 3;
  JUMP      = 4;
}

message NUserInfo {
  int32       id     = 1;
  NPlayerInfo player = 2;
}

message NPlayerInfo {
  int32                   id         = 1;
  repeated NCharacterInfo characters = 2;
}

message NCharacterInfo {
  int32           id     = 1; // 角色唯一ID（通常对应数据库角色ID）
  int32           tid    = 2; // 角色模板ID（对应配置表的角色/怪物/NPC模板）
  string          name   = 3; // 角色名字（玩家角色名或怪物/NPC显示名）
  CHARACTER_TYPE  type   = 4; // 角色类型（Player/NPC/Monster）
  CHARACTER_CLASS class  = 5; // 职业（仅 Player 有意义；NPC/Monster 可忽略或当作默认值）
  int32           level  = 6; // 等级
  int32           mapId  = 7; // 当前所在地图ID（对应 MapDefine.ID）
  NEntity         entity = 8; // 实体基础数据（位置/朝向/速度等），用于同步与展示
}

message NVector3 {
  int32 x = 1;
  int32 y = 2;
  int32 z = 3;
}

message NVector2 {
  int32 x = 1;
  int32 y = 2;
}

////////////////////////////////////////////////////////////////
//
//  Entities
//
////////////////////////////////////////////////////////////////

message NEntity {
  int32    id        = 1;
  NVector3 position  = 2;
  NVector3 direction = 3;
  int32    speed     = 4;
}

message NEntitySync {
  int32        id     = 1;
  ENTITY_EVENT event  = 2;
  NEntity      entity = 3;
}

////////////////////////////////////////////////////////////////
//
//  Messages
//
////////////////////////////////////////////////////////////////

message NetMessage {
  NetMessageRequest  Request  = 1;
  NetMessageResponse Response = 2;
}

// NetMessageRequest：客户端 ->
// 服务器的统一请求封包，字段号与响应保持一一对应，避免序列化冲突。
message NetMessageRequest {
  UserRegisterRequest        userRegister      = 1; // 1: 用户注册
  UserLoginRequest           userLogin         = 2; // 2: 用户登录
  UserCreateCharacterRequest createChar        = 3; // 3: 创角
  UserDeleteCharacterRequest deleteChar        = 4; // 4: 删角
  UserGameEnterRequest       gameEnter         = 5; // 5: 进入游戏
  UserGameLeaveRequest       gameLeave         = 6; // 6: 离开游戏
  MapCharacterEnterRequest   mapCharacterEnter = 7; // 7: 进入地图
  MapCharacterLeaveRequest   mapCharacterLeave = 8; // 8: 离开地图
  MapEntitySyncRequest       mapEntitySync     = 9; // 9: 地图内实体同步
  MapTeleportRequest         mapTeleport       = 10; // 10: 传送
}

// NetMessageResponse：服务器 ->
// 客户端的统一响应封包，字段号与请求保持一致，便于一一对应。
message NetMessageResponse {
  UserRegisterResponse        userRegister      = 1; // 1: 用户注册
  UserLoginResponse           userLogin         = 2; // 2: 用户登录
  UserCreateCharacterResponse createChar        = 3; // 3: 创角
  UserDeleteCharacterResponse deleteChar        = 4; // 4: 删角
  UserGameEnterResponse       gameEnter         = 5; // 5: 进入游戏
  UserGameLeaveResponse       gameLeave         = 6; // 6: 离开游戏
  MapCharacterEnterResponse   mapCharacterEnter = 7; // 7: 进入地图
  MapCharacterLeaveResponse   mapCharacterLeave = 8; // 8: 离开地图
  MapEntitySyncResponse       mapEntitySync     = 9; // 9: 地图内实体同步
  MapTeleportResponse         mapTeleport       = 10; // 10: 传送
}

// User Protocol
message UserLoginRequest {
  string user     = 1;
  string password = 2;
}

message UserLoginResponse {
  RESULT    result   = 1;
  string    errormsg = 2;
  NUserInfo userinfo = 3;
}

message UserRegisterRequest {
  string user     = 1;
  string password = 2;
  int32  age      = 3;
}

message UserRegisterResponse {
  RESULT result   = 1;
  string errormsg = 2;
}

message UserCreateCharacterRequest {
  string          name  = 1;
  CHARACTER_CLASS class = 2;
}

message UserCreateCharacterResponse {
  RESULT                  result     = 1;
  string                  errormsg   = 2;
  repeated NCharacterInfo characters = 3;
}

// 删除角色
message UserDeleteCharacterRequest {
  int32 characterId = 1; // 要删除的角色 ID
}

message UserDeleteCharacterResponse {
  RESULT                  result     = 1;
  string                  errormsg   = 2;
  repeated NCharacterInfo characters = 3; // 删除后的角色列表
}

message UserGameEnterRequest { int32 characterIdx = 1; }

message UserGameEnterResponse {
  RESULT result   = 1;
  string errormsg = 2;
}

message UserGameLeaveRequest {}

message UserGameLeaveResponse {
  RESULT result   = 1;
  string errormsg = 2;
}

// Map Protocol
message MapCharacterEnterRequest { int32 mapId = 1; }

message MapCharacterEnterResponse {
  int32                   mapId      = 1;
  repeated NCharacterInfo characters = 2;
}

message MapCharacterLeaveRequest {
  int32 mapId       = 1; // 离开的地图
  int32 characterId = 2; // 离开的角色
}

message MapCharacterLeaveResponse { int32 characterId = 1; }

message MapEntitySyncRequest { NEntitySync entitySync = 1; }

message MapEntitySyncResponse { repeated NEntitySync entitySyncs = 2; }

message MapTeleportRequest { int32 teleporterId = 1; }

message MapTeleportResponse {
  RESULT result   = 1;
  string errormsg = 2;
}
