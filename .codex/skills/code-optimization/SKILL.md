---
name: code-optimization
description: 在不改变任何功能行为的前提下，参考国外优秀开源项目，对代码顺序与排版进行结构性整理，以显著提升可读性与工程美感。仅在用户提供明确代码路径时使用。
---

# Code Optimization

## 目标
- **只做结构优化 / 可读性优化 / 风格对齐**。
- **不改变任何功能与行为**：不引入新逻辑、不删除既有逻辑、不改 API 语义。
- 参考高质量开源项目的常见结构实践，让代码“第一次阅读就能快速理解”。

## 允许的改动（不改变行为）
- 调整 `using` 顺序、删除未使用引用。
- 重排成员顺序与分区（字段 → 构造/生命周期 → 公共方法 → 私有方法）。
- 统一缩进、空行、括号风格与可读性排版。
- 添加必要的结构性分区（如 `#region`）**仅用于组织结构**。
 - **必须使用最小 diff**：只做就地调整，不删除并重建文件；保留原有换行风格与编码。
- 添加中英文注释（仅用于解释代码意图，不改变逻辑）。

## 明确禁止的改动
- 不新增/删除逻辑分支、条件、循环、调用。
- 不修改行为、输入输出、返回值、异常路径。
- 不改变序列化字段/Unity 绑定字段名称（除非用户明确允许）。
- 不更改任何外部接口/协议字段/数据格式。

## 需用户明确授权的改动（默认不做）
- 重命名（包含字段/方法/类），即使仅为可读性提升。
- 提取常量（可能影响序列化或配置）。
- 拆分/合并方法（改变调用边界）。
- 任何可能影响序列化、反射、Unity Inspector 绑定的调整。

## 结构整理参考顺序
1) `using` 分组与排序  
2) 常量/静态字段  
3) 公共字段与序列化字段  
4) 私有字段  
5) 构造函数/初始化  
6) 生命周期方法（Awake/Start/Update/LateUpdate/OnDestroy）  
7) 公共方法  
8) 私有方法  

## 工作流程
1) 读取用户提供的代码路径与文件内容。  
2) 识别当前结构问题（顺序混乱、分区缺失、引用杂乱）。  
3) 给出“结构调整预览”（字段/生命周期/公共/私有的预期顺序）并等待确认（如用户要求）。  
4) 按“高质量开源项目”常见结构重排（仅结构，不改逻辑）。  
5) 输出修改摘要与路径列表，提醒不应改变运行行为。  

## 输出要求
- 说明结构重排的意图与范围（可审查）。  
- Diff 控制在“可读性变化”范围内。  
- 如发现可能影响行为的改动风险，必须停下并提示用户确认。  
